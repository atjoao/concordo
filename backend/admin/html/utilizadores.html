<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Utilizadores | Admin</title>
        <link rel="stylesheet" href="./assets/css/pico.min.css" />
    </head>
    <style>
        body {
            margin: 0 auto;
            max-width: 1170px;
        }
    </style>
    <body>
        <nav>
            <ul>
                <li
                    style="
                        display: flex !important;
                        align-items: center !important;
                        gap: 10px;
                    "
                >
                    <img
                        src="./assets/images/logoConcordo.png"
                        alt=""
                        width="64"
                        height="64"
                    />
                    <span
                        style="
                            font-family: ComicNeue-Regular;
                            font-size: 24px;
                            padding-bottom: 10px;
                        "
                    >
                        Concordo
                    </span>
                </li>
            </ul>
            <ul>
                <li>
                    <a href="/admin" class="contrast">Inicio</a>
                </li>
                <li>
                    <a href="/admin/utilizadores">Utilizadores</a>
                </li>
                <li>
                    <a href="/admin/avisos" class="contrast">Avisos</a>
                </li>
            </ul>
        </nav>

        <main id="content">
            <h3>Utilizadores Registrados no Concordo</h3>
            <table>
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Nome</th>
                        <th scope="col">Tag</th>
                        <th scope="col">Email</th>
                        <th scope="col">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5">
                            <span aria-busy="true">A carregar...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </main>
    </body>

    <script src="./assets/js/loadcheck.js"></script>

    <script>
        const tbody = document.querySelector("tbody");

        window.onload = async () => {
            const data = await fetch("./getUtilizadores", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${localStorage.getItem("token")}`,
                },
            });
            if (!data.ok) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4">Erro ao carregar dados</td>
                    </tr>
                `;
            } else {
                const json = await data.json();
                setTimeout(() => {
                    tbody.innerHTML = "";
                    if (!json.users) return;
                    json.users.forEach((user) => {
                        const tr = document.createElement("tr");

                        tr.innerHTML = `
                            <td>${user._id}</td>
                            <td>${user.username}</td>
                            <td>${user.descrim}</td>
                            <td>${user.email}</td>
                            <td style="display: flex; gap: 10px">
                                <button onclick="toggleEdit(${user._id})">Editar</button>
                                <button onclick="toggleDelete(${user._id})">Apagar</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }, 500);
            }
        };
    </script>
</html>
